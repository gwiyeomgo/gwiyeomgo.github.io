"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[933],{2618:function(e,n,l){l.r(n),l.d(n,{Head:function(){return u.p},default:function(){return o}});var t=l(6540),c=l(8453);function r(e){const n=Object.assign({h1:"h1",p:"p",ol:"ol",li:"li",blockquote:"blockquote",ul:"ul",code:"code"},(0,c.RP)(),e.components);return t.createElement(t.Fragment,null,t.createElement(n.h1,null,"배경"),"\n",t.createElement(n.p,null,"5초 이상 속도 지연되면 알림이 온다\n자주 오는 알림중 업무 목록 API 속도를 개선하려고 한다"),"\n",t.createElement(n.h1,null,"분석"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"\n",t.createElement(n.p,null,"로그를 통해 쿼리를 확인하니\nWHERE 절 out_id  IN 조건 값이 너무 많았다"),"\n"),"\n",t.createElement(n.li,null,"\n",t.createElement(n.p,null,"EXPLAIN 실행하니 인덱스는 2개 있지만\ncollects 테이블에서 type ALL 으로 전체 스캔 하고 있으며 rows 92563건으로 많다\nUsing where 로 WHERE 조건으로 필터링중"),"\n"),"\n",t.createElement(n.li,null,"\n",t.createElement(n.p,null,"EXPLAIN ANALYZE 실행\nFilter 조건이 많고  실행 시간 오래 걸리는 가장 핵심적인 병목 구간 존재"),"\n"),"\n"),"\n",t.createElement(n.blockquote,null,"\n",t.createElement(n.p,null,"Table scan on collects  (cost=15236 rows=92568) (actual time=2.04..4482 rows=112417 loops=1)"),"\n"),"\n",t.createElement(n.ul,null,"\n",t.createElement(n.li,null,"실제로 4.4초 이상 소요됨\n| 표현                | 의미                            | 단위     |\n|---------------------|----------------------------------|----------|\n| ",t.createElement(n.code,null,"actual time=2.04"),"  | 첫 결과 row까지 걸린 시간        | 밀리초   |\n| ",t.createElement(n.code,null,"actual time=4482"),"  | 모든 row 처리 완료까지 걸린 시간 | 밀리초   |\n| 차이 = 4480ms       | 총 소요 시간 (≈ 4.4초)            | 초로 환산 가능 |"),"\n"),"\n",t.createElement(n.h1,null,"개선 부분"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"donation_collects 테이블의 WHERE 조건들이 인덱스를 타도록 설계\n특히 basecamp_give_id"),"\n",t.createElement(n.li,null,"IN (  ...) 은 JOIN으로 변경? CTE(공통 테이블 식)로 JOIN?\nIN (...)에 값이 너무 많으면 옵티마이저가 인덱스를 제대로 활용하지 못한데..??\nWITH 키워드 사용해 basecamp_give_id 배열 테이블 만들고 조인해서 쿼리 비교 예정"),"\n"))}var a=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,c.RP)(),e.components);return n?t.createElement(n,e,t.createElement(r,e)):r(e)},u=l(7292);function o(e){return t.createElement(u.A,e,t.createElement(a,e))}u.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-database-mysql-2025-04-03-mysql-optimized-task-api-mdx-09eaa786dec75d35f7de.js.map