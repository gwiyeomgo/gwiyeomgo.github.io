"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[940],{3838:function(e,n,t){t.r(n),t.d(n,{Head:function(){return o.p},default:function(){return c}});var l=t(6540),E=t(8453);function u(e){const n=Object.assign({h1:"h1",p:"p",ul:"ul",li:"li",pre:"pre",code:"code",blockquote:"blockquote"},(0,E.RP)(),e.components);return l.createElement(l.Fragment,null,l.createElement(n.h1,null,"배경"),"\n",l.createElement(n.p,null,"기존 테이블에서 물리적으로 unique key 로 사용하던 out_id 필드가 있었는데\n기능이 확장되면서 group_id 가 추가 예정이있다"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"out_id 가 있는 경우 group_id는 존재하지 않음"),"\n",l.createElement(n.li,null,"group_id 가 있는 경우 out_id는 존재하지 않음"),"\n",l.createElement(n.li,null,"group_id와 out_id는 서로 동시에 존재하지 않음 (상호배타)"),"\n"),"\n",l.createElement(n.h1,null,"MySQL 8 이상 CHECK 제약 (IS NULL XOR IS NOT NULL)"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"ALTER TABLE test_table\nADD CONSTRAINT chk_group_out_exclusive\nCHECK (\n  (group_id IS NOT NULL AND out_id IS NULL) OR\n  (group_id IS NULL AND out_id IS NOT NULL)\n);\n\n")),"\n",l.createElement(n.h1,null,"존재하는 값의 유일성 보장 (단, NULL 중복은 허용됨)"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"ALTER TABLE test_table\nADD UNIQUE KEY uniq_out_id (out_id),\nADD UNIQUE KEY uniq_group_id (group_id);\n")),"\n",l.createElement(n.p,null,"하지만 NULL 중복은 막지 못함  => 유일성 보장 X\nMySQL에서 NULL ≠ NULL 이므로\nUNIQUE(out_id)는 중복으로 보지 않음"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"INSERT INTO test_table (group_id, out_id) VALUES ('G1', NULL); -- OK\nINSERT INTO test_table (group_id, out_id) VALUES ('G2', NULL); -- OK (UNIQUE 위반 아님)\n")),"\n",l.createElement(n.h1,null,"트리거 추가 (NULL 중복까지 완전히 막음 (INSERT 기준))"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"트리거 적용시 insert 할때 마다 발동"),"\n"),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"out_id IS NOT NULL일 때 중복 막기"),"\n"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"CREATE TRIGGER trg_out_id_unique\nBEFORE INSERT ON test_table\nFOR EACH ROW\nBEGIN\n  IF NEW.out_id IS NOT NULL THEN\n    IF EXISTS (SELECT 1 FROM test_table WHERE out_id = NEW.out_id) THEN\n      SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Duplicate out_id not allowed';\n    END IF;\n  END IF;\nEND;\n")),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"group_id IS NOT NULL일 때 중복 막기"),"\n"),"\n",l.createElement(n.pre,null,l.createElement(n.code,null,"CREATE TRIGGER trg_group_id_unique\nBEFORE INSERT ON test_table\nFOR EACH ROW\nBEGIN\n  IF NEW.group_id IS NOT NULL THEN\n    IF EXISTS (SELECT 1 FROM test_table WHERE group_id = NEW.group_id) THEN\n      SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Duplicate group_id not allowed';\n    END IF;\n  END IF;\nEND;\n")))}var r=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,E.RP)(),e.components);return n?l.createElement(n,e,l.createElement(u,e)):u(e)},o=t(7292);function c(e){return l.createElement(o.A,e,l.createElement(r,e))}o.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-database-mysql-2025-04-30-mysql-checkconstraint-mdx-7caeef41db3f7614b654.js.map