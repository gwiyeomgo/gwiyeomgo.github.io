"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[933],{2618:function(e,n,l){l.r(n),l.d(n,{Head:function(){return u.p},default:function(){return o}});var t=l(6540),c=l(8453);function a(e){const n=Object.assign({h1:"h1",p:"p",ol:"ol",li:"li",blockquote:"blockquote",code:"code",ul:"ul"},(0,c.RP)(),e.components);return t.createElement(t.Fragment,null,t.createElement(n.h1,null,"배경"),"\n",t.createElement(n.p,null,"5초 이상 속도 지연되면 알림이 온다\n자주 오는 알림중 업무 목록 API 속도를 개선하려고 한다"),"\n",t.createElement(n.h1,null,"분석"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"\n",t.createElement(n.p,null,"로그를 통해 쿼리를 확인하니\nWHERE 절 out_id  IN 조건 값이 너무 많았다 (인덱스 타지 않음)"),"\n"),"\n",t.createElement(n.li,null,"\n",t.createElement(n.p,null,"EXPLAIN 실행하니 인덱스는 2개 있지만\ncollects 테이블에서 type ALL 으로 전체 스캔 하고 있으며 rows 92563건으로 많다\nUsing where 로 WHERE 조건으로 필터링중"),"\n"),"\n"),"\n",t.createElement(n.h1,null,"개선 작업"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"\n",t.createElement(n.p,null,"donation_collects 테이블의 WHERE 조건들이 인덱스를 타도록 설계"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"basecamp_give_id 인덱스 추가 -> 변화 X"),"\n",t.createElement(n.li,null,"여러 조건으로 복합인덱스를 추가해서 개발환경에서 확인했지만 효과 없고 사용 안함\n복합 인덱스(admin_account_member_id, plan_visit_date, deleted_at)는 추가됐지만 사용되지 않음"),"\n",t.createElement(n.li,null,"대신 여전히 단일 인덱스인 idx_donation_collects_plan_visit_date만 사용"),"\n"),"\n"),"\n"),"\n",t.createElement(n.blockquote,null,"\n",t.createElement(n.p,null,"왜 인덱스를 안타지?"),"\n"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"MySQL 옵티마이저는 성능이 인덱스보다 풀 스캔이 빠르다고 판단하면 인덱스를 안탄다?\nIN (1,2,3,...,10000) 식으로 값이 매우 많을 경우, 인덱스를 포기"),"\n",t.createElement(n.li,null,"OR 조건 또는 복잡한 조건 조합\nOR을 사용\n(A AND B) OR (C AND D) 처럼 조건 분기가 생기면 인덱스를 못 타는 경우가 생김"),"\n"),"\n",t.createElement(n.h1,null,"작업 내용"),"\n",t.createElement(n.ol,null,"\n",t.createElement(n.li,null,"복합 인덱스를 조건 순서대로 만들고"),"\n",t.createElement(n.li,null,"OR → UNION ALL 방식으로 쿼리 분해"),"\n",t.createElement(n.li,null,"기존 기능 동작하는지 테스트"),"\n"),"\n",t.createElement(n.h1,null,"확인 방법"),"\n",t.createElement(n.p,null,"*",t.createElement(n.code,null,"SHOW INDEX FROM donation_collects")," 인덱스 사용"),"\n",t.createElement(n.ul,null,"\n",t.createElement(n.li,null,"EXPLAIN type ALL -> Ref"),"\n"))}var r=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,c.RP)(),e.components);return n?t.createElement(n,e,t.createElement(a,e)):a(e)},u=l(7292);function o(e){return t.createElement(u.A,e,t.createElement(r,e))}u.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-database-mysql-2025-04-03-mysql-optimized-task-api-mdx-ac144e78a83ed569d0ec.js.map