{"version":3,"file":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-c-github-gwiyeomgo-github-io-content-posts-server-database-mysql-2022-09-07-mysql-add-revision-table-mdx-71fb48dbdf6f2897fca2.js","mappings":"mNAGA,SAASA,EAAkBC,GACzB,MAAMC,EAAcC,OAAOC,OAAO,CAChCC,EAAG,IACHC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,IAAK,MACLC,KAAM,SACLC,EAAAA,EAAAA,MAAsBX,EAAMY,YAC/B,OAAOC,EAAAA,cAAoBA,EAAAA,SAAgB,KAAMA,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,oEAAqE,KAAMS,EAAAA,cAAoBZ,EAAYI,GAAI,KAAM,MAAO,KAAMQ,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,mIAAoI,KAAMS,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,8GAA+G,KAAMS,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,gFAAiF,KAAMS,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,2CAA4C,KAAMS,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,8GAA+G,KAAMS,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,gDAAiD,KAAMS,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,mNAAoN,KAAMS,EAAAA,cAAoBZ,EAAYI,GAAI,KAAM,QAAS,KAAMQ,EAAAA,cAAoBZ,EAAYK,GAAI,KAAM,KAAMO,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,yBAA0B,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,8BAA+B,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,4BAA6B,KAAMM,EAAAA,cAAoBZ,EAAYO,GAAI,KAAM,KAAMK,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,WAAY,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,8BAA+B,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,oCAAqC,MAAO,MAAO,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,2DAA4D,MAAO,KAAMM,EAAAA,cAAoBZ,EAAYI,GAAI,KAAM,YAAa,KAAMQ,EAAAA,cAAoBZ,EAAYG,EAAG,KAAM,sBAAuB,KAAMS,EAAAA,cAAoBZ,EAAYO,GAAI,KAAM,KAAMK,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,aAAc,KAAMM,EAAAA,cAAoBZ,EAAYO,GAAI,KAAM,KAAMK,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,+BAAgC,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,uBAAwB,MAAO,MAAO,KAAMM,EAAAA,cAAoBZ,EAAYM,GAAI,KAAM,mQAAoQ,MAAO,KAAMM,EAAAA,cAAoBZ,EAAYI,GAAI,KAAM,sBAAuB,KAAMQ,EAAAA,cAAoBZ,EAAYQ,IAAK,KAAMI,EAAAA,cAAoBZ,EAAYS,KAAM,KAAM,sfAAuf,KAAMG,EAAAA,cAAoBZ,EAAYI,GAAI,KAAM,gCAAiC,KAAMQ,EAAAA,cAAoBZ,EAAYQ,IAAK,KAAMI,EAAAA,cAAoBZ,EAAYS,KAAM,KAAM,2FAA4F,KAAMG,EAAAA,cAAoBZ,EAAYQ,IAAK,KAAMI,EAAAA,cAAoBZ,EAAYS,KAAM,KAAM,0PACzuH,CAKA,MAJA,SAAoBV,QAAK,IAALA,IAAAA,EAAQ,CAAC,GAC3B,MAAOc,QAASC,GAAab,OAAOC,OAAO,CAAC,GAAGQ,EAAAA,EAAAA,MAAsBX,EAAMY,YAC3E,OAAOG,EAAYF,EAAAA,cAAoBE,EAAWf,EAAOa,EAAAA,cAAoBd,EAAmBC,IAAUD,EAAkBC,EAC9H,E,UCde,SAASgB,EAAiBhB,GACvC,OAAOa,EAAAA,cAAoBI,EAAAA,EAAejB,EAAOa,EAAAA,cAAoBK,EAAqBlB,GAC5F,CAHAiB,EAAAA,C","sources":["webpack://gwiyeom-blog/./content/posts/server/database/mysql/2022-09-07-mysql-add-revision-table.mdx","webpack://gwiyeom-blog/./node_modules/@lekoarts/gatsby-theme-minimal-blog-core/src/templates/post-query.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h1: \"h1\",\n    ul: \"ul\",\n    li: \"li\",\n    ol: \"ol\",\n    pre: \"pre\",\n    code: \"code\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"Experience adding a the cellphone number revision table in mysql\"), \"\\n\", React.createElement(_components.h1, null, \"배경\"), \"\\n\", React.createElement(_components.p, null, \"1.회원 테이블에는 회원가입한 휴대번호를 저장하고있다 (암호화된 휴대번호)\\r\\n2.초기 택배 기부 시스템의 영향으로 회원과 기부자가 같지않다\\r\\n3.기부영수증은 기부자만 발급할 수 있으며 지금 시스템의 회원은 기부자가 아니다\"), \"\\n\", React.createElement(_components.p, null, \"상황1) 어머니가 매장에 기부함.\\r\\n딸에게 공제 혜택을 주고 싶다.\\r\\n어머니는 딸의 주민등록 번호를 모른다.\\r\\n딸이 직접 입력하게 하기 위해서 휴대폰번호를 바꾸는 상황이 종종 발생\"), \"\\n\", React.createElement(_components.p, null, \"어머님이 다음에 기부하러 왔는데\\r\\n본인이 바꾸셨는데 기억하지 못한다.\\r\\n매장오셔서 딸에게 문자가 계속 온다고 불만을 요청하심...\"), \"\\n\", React.createElement(_components.p, null, \"문제) 매니저님이 그 회원이 휴대폰 번호를 변경했는지 조회가 불가능하다\"), \"\\n\", React.createElement(_components.p, null, \"상황2) 아내가 매장에 기부함.\\r\\n남편에게 공제 혜택을 주고 싶다.\\r\\n아내는 딸의 주민등록 번호를 모른다.\\r\\n남편이 직접 입력하게 하기 위해서 휴대폰번호를 바꾸는 상황이 종종 발생\"), \"\\n\", React.createElement(_components.p, null, \"본인이 바꾸셨는데 기억하지 못한다\\r\\n아내는 알림톡이 안온다고 불만을 요청하심\"), \"\\n\", React.createElement(_components.p, null, \"관리자가 문제를 확인하려고 어드민 기부 목록에서 휴대번호를 조회했는데 검색내용의 휴대번호가  검색한 휴대번호와 다르다.\\r\\n문제1)    관리자는 오류라고 생각하고 개발자에게 확인요청, 오류는 아니고 목록에서는 현재 회원의 휴대번호가 보이는 상황이다.\\r\\n=> 이부분은 개선작업이 필요\\r\\n문제2)    관리자는 그 회원이 휴대폰 번호를 변경했는지 조회가 불가능하다\"), \"\\n\", React.createElement(_components.h1, null, \"작업내용\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"휴대번호 변경 이력을 관리 테이블 추가\"), \"\\n\", React.createElement(_components.li, null, \"휴대번호 변경 이력을 저장,조회하는 API 개발\"), \"\\n\", React.createElement(_components.li, null, \"어드민 방문기부,택배기부 목록에 검색기능 개선\", \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"휴대번호 검색\"), \"\\n\", React.createElement(_components.li, null, \"휴대번호 변경 이력에서 memberId 를 찾고\"), \"\\n\", React.createElement(_components.li, null, \"memberId 에 해당하는 기부이력 전체 보여지도록 수정\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"회원 어드민 목록에 회원 상세 페이지 추가 개발 (해당 페이지에서 휴대번호 변경이력을 볼 수 있음)\"), \"\\n\"), \"\\n\", React.createElement(_components.h1, null, \"테이블 추가작업\"), \"\\n\", React.createElement(_components.p, null, \"회원의 휴대번호 이력 관리 테이블\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"언제 데이터 추가?\", \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"최초 member 가입시 추가 (재가입자도 포함)\"), \"\\n\", React.createElement(_components.li, null, \"회원이 휴대번호 변경 완료 후 추가\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"테이블 추가 이전데이터는 어떻게 처리?\\r\\n1.탈퇴한 회원? => 이경우 이전 회원 정보는 탈퇴 표시 컬럼에 true 가 표시되고 새로운 회원 id 를 부여받음 (영향 없음)\\r\\n2.지금은 휴대번호가 꼭 입력된다 ,과거 데이터에 휴대번호가 없는 회원이 있다 => 휴대번호가 없는 회원?\\r\\n과거 데이터는 그대로 mobile 컬럼에 공백으로 저장\\r\\n휴대폰 번호 변경시 새 컬럼이 추가됨으로 member_id 로 특정 회원의 변경 이력을 볼 수 있다.\"), \"\\n\"), \"\\n\", React.createElement(_components.h1, null, \"mysql CREATE TABLE\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, null, \"CREATE TABLE IF NOT EXISTS member_cellphone_number_revisions(\\r\\n    id                            INT NOT NULL AUTO_INCREMENT,\\r\\n    member_id                     INT NOT NULL COMMENT 'member ID',\\r\\n    mobile                        VARCHAR(50) NOT NULL COMMENT '변경된 휴대번호',\\r\\n    created                       JSON NOT NULL,\\r\\n    PRIMARY KEY(id),\\r\\n    CONSTRAINT fk_member_cellphone_number_revisions_members\\r\\n        FOREIGN KEY (member_id)\\r\\n            REFERENCES members (id)\\r\\n);\\n\")), \"\\n\", React.createElement(_components.h1, null, \"mysql SELECT 된 결과로 INSERT 하기\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, null, \"INSERT INTO 들어갈테이블명\\r\\n(컬럼명1, 컬럼명2, 컬럼명3)\\r\\nSELECT 컬럼명1, 컬럼명2, 컬럼명3\\r\\nFROM 조회할테이블명\\n\")), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, null, \"INSERT INTO member_cellphone_number_revisions\\r\\n(member_id, mobile, created)\\r\\nselect id as member_id, mobile , json_object(\\r\\n'id', '',\\r\\n'name', '',\\r\\n'datetime', DATE_FORMAT(NOW(),'%Y-%m-%d %h:%m:%s')\\r\\n) as created from  members as m\\n\")));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import React from \"react\";\nimport GATSBY_COMPILED_MDX from \"C:/github/gwiyeomgo.github.io/content/posts/server/database/mysql/2022-09-07-mysql-add-revision-table.mdx\";\nimport PostComponent, {Head} from \"../components/post\";\nPostComponent\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostComponent, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\nexport {Head};\nconst query = \"2040642971\";\n"],"names":["_createMdxContent","props","_components","Object","assign","p","h1","ul","li","ol","pre","code","_provideComponents","components","React","wrapper","MDXLayout","GatsbyMDXWrapper","PostComponent","GATSBY_COMPILED_MDX"],"sourceRoot":""}