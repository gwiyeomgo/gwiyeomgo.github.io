"use strict";(self.webpackChunkgwiyeom_blog=self.webpackChunkgwiyeom_blog||[]).push([[7117],{6818:function(e,t,l){l.r(t),l.d(t,{Head:function(){return E.p},default:function(){return m}});var n=l(6540),r=l(8453);function a(e){const t=Object.assign({h1:"h1",p:"p",h2:"h2",h3:"h3",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",code:"code",blockquote:"blockquote",hr:"hr"},(0,r.RP)(),e.components);return n.createElement(n.Fragment,null,n.createElement(t.h1,null,"배경"),"\n",n.createElement(t.p,null,"db 부하가 발생해 그라파나 CPU 사용률이 60% 이상 발생했다\nDB부하는 단지 query 속도보다 지속적인 WriteIOP 횟수와 연관이 있다는 피드백을 받갔고\nreplication/synchronization등과도 관련있을 수도 있다고 한다\n용어를 잘 모르니 정리해보자"),"\n",n.createElement(t.h2,null,"DB 부하란?"),"\n",n.createElement(t.p,null,"1.CPU 사용률, 메모리 사용량\n2.디스크 I/O (특히 Write IOPS)\n3.락/경합\n4.네트워크 대역폭\n연결 수 및 커넥션 풀 상태"),"\n",n.createElement(t.p,null,"replication/sync 지연"),"\n",n.createElement(t.h3,null,"MySQL에서 쿼리를 날렸을 때 replication/Synchronization 발생"),"\n",n.createElement(t.p,null,"우리가 쿼리 하나 날리면\n그게 복제(replication)를 통해 다른 서버로 전달되고\n이 서버들이 같은 상태를 유지하려는 게 동기화(synchronization)"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"상황"),n.createElement(t.th,null,"관련 개념"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"쿼리를 Primary에 작성"),n.createElement(t.td,null,"(우리가 하는 일)"),n.createElement(t.td,null,n.createElement(t.code,null,"INSERT"),", ",n.createElement(t.code,null,"UPDATE")," 등 쿼리 실행")),n.createElement(t.tr,null,n.createElement(t.td,null,"binlog에 기록"),n.createElement(t.td,null,"Replication 준비"),n.createElement(t.td,null,"복제를 위한 로그 기록")),n.createElement(t.tr,null,n.createElement(t.td,null,"Replica가 binlog 읽음"),n.createElement(t.td,null,"Replication"),n.createElement(t.td,null,"쿼리를 복사해 실행")),n.createElement(t.tr,null,n.createElement(t.td,null,"Replica가 최신 상태로 유지됨"),n.createElement(t.td,null,"Synchronization"),n.createElement(t.td,null,"데이터가 모두 같게 유지됨")))),"\n",n.createElement(t.blockquote,null,"\n",n.createElement(t.p,null,"Replica를 직접 건드리지 않지만 우리가 작성한 쿼리가 복제를 통해 전달되면서도 부하를 발생시킨다?"),"\n"),"\n",n.createElement(t.p,null,"mysql 에서 db 상황을 보고 어떻게 진단하지?"),"\n",n.createElement(t.h2,null,"실무에서 알면 유용한 MySQL 명령어 정리"),"\n",n.createElement(t.h3,null,"세션 및 커넥션 관련"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW PROCESSLIST;"),n.createElement(t.td,null,"현재 접속된 세션과 상태 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW FULL PROCESSLIST;"),n.createElement(t.td,null,"실행 중인 쿼리 전체 내용까지 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SELECT * FROM information_schema.processlist;"),n.createElement(t.td,null,n.createElement(t.code,null,"SHOW PROCESSLIST"),"의 SQL 버전, 필터링/정렬 가능")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW STATUS LIKE 'Threads_connected';"),n.createElement(t.td,null,"현재 접속 중인 커넥션 수")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW STATUS LIKE 'Threads_running';"),n.createElement(t.td,null,"현재 실행 중인 쿼리 수")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW STATUS LIKE 'Connections';"),n.createElement(t.td,null,"MySQL 시작 후 총 접속 시도 수")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW VARIABLES LIKE 'max_connections';"),n.createElement(t.td,null,"최대 허용 커넥션 수")))),"\n",n.createElement(t.hr),"\n",n.createElement(t.h3,null,"Sleep/Idle 세션 분석"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SELECT id, user, host, db, command, time FROM information_schema.processlist WHERE command = 'Sleep' ORDER BY time DESC LIMIT 10;"),n.createElement(t.td,null,"오래된 Sleep 커넥션 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW VARIABLES LIKE '%timeout%';"),n.createElement(t.td,null,"커넥션 유지 관련 timeout 설정 확인 (",n.createElement(t.code,null,"wait_timeout"),", ",n.createElement(t.code,null,"interactive_timeout")," 등)")))),"\n",n.createElement(t.hr),"\n",n.createElement(t.h3,null,"쿼리/슬로우쿼리 분석"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW VARIABLES LIKE 'slow_query_log%';"),n.createElement(t.td,null,"슬로우 쿼리 로그 설정 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW GLOBAL STATUS LIKE 'Slow_queries';"),n.createElement(t.td,null,"슬로우 쿼리 발생 수 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SET profiling = 1;"),n.createElement(t.td,null,"쿼리 프로파일링 활성화")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW PROFILE;"),n.createElement(t.td,null,"가장 최근 쿼리의 리소스 소비 단계별 분석")))),"\n",n.createElement(t.hr),"\n",n.createElement(t.h3,null,"락 / 트랜잭션 분석"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW ENGINE INNODB STATUS"),n.createElement(t.td,null,"락/트랜잭션 상세 정보 (InnoDB 전용)")),n.createElement(t.tr,null,n.createElement(t.td,null,"SELECT * FROM information_schema.innodb_trx;"),n.createElement(t.td,null,"현재 실행 중인 트랜잭션 조회")),n.createElement(t.tr,null,n.createElement(t.td,null,"SELECT * FROM information_schema.innodb_locks;"),n.createElement(t.td,null,"현재 활성화된 락 조회")),n.createElement(t.tr,null,n.createElement(t.td,null,"SELECT * FROM information_schema.innodb_lock_waits;"),n.createElement(t.td,null,"락 대기 관계 조회")))),"\n",n.createElement(t.hr),"\n",n.createElement(t.h3,null,"복제(Replication) 상태 진단"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW SLAVE STATUS"),n.createElement(t.td,null,"슬레이브(Replica) 복제 상태 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW MASTER STATUS;"),n.createElement(t.td,null,"마스터의 binlog 위치 등 복제 정보 확인")))),"\n",n.createElement(t.hr),"\n",n.createElement(t.h3,null,"서버 상태/통계"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW STATUS LIKE 'Uptime';"),n.createElement(t.td,null,"MySQL 서버의 가동 시간 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW STATUS LIKE 'Handler%';"),n.createElement(t.td,null,"테이블 핸들러 상태 (테이블 액세스 방식 확인)")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW STATUS LIKE 'Threads%';"),n.createElement(t.td,null,"커넥션/스레드 관련 상태 전반 확인")))),"\n",n.createElement(t.hr),"\n",n.createElement(t.h3,null,"설정/환경 확인"),"\n",n.createElement(t.table,null,n.createElement(t.thead,null,n.createElement(t.tr,null,n.createElement(t.th,null,"명령어"),n.createElement(t.th,null,"설명"))),n.createElement(t.tbody,null,n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW VARIABLES LIKE '%timeout%';"),n.createElement(t.td,null,"타임아웃 관련 설정 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW VARIABLES LIKE 'max_connections';"),n.createElement(t.td,null,"최대 접속 수 설정 확인")),n.createElement(t.tr,null,n.createElement(t.td,null,"SHOW VARIABLES LIKE 'innodb%';"),n.createElement(t.td,null,"InnoDB 관련 설정 확인")))))}var c=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,r.RP)(),e.components);return t?n.createElement(t,e,n.createElement(a,e)):a(e)},E=l(7292);function m(e){return n.createElement(E.A,e,n.createElement(c,e))}E.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-server-database-mysql-2025-04-02-mysql-db-load-mdx-d2ea9148f2088b645349.js.map